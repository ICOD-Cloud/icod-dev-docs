# События

У улакос существует продвинутая система событий. Так как мы хотим что бы любой модуль мог оказать влияние на работу любого другого модуля, такая система просто необходима.

### Как обработать событие

Допустим вы хотите что бы ваш код сработал на определенное событе. Для этого вам нужно зарегистрировать свой обработчик в файле `meta.json`. Вот пример:

```json
{
	"title": "My Module",
	"events": {
		"register": {
			"before_user_auth_logout": "\\Module\\Lib\\Classname"
		}
	}
}
```

Где `before_user_auth_logout` это имя события а `\\Module\\Lib\\Classname` это имя класса который готов это событие обработать.

Теперь создаете данный класс.

```php
<?php
namespace Module\Lib;
use Acl\Lib\Helper AS AclHelper;
class Classname
{
	static public function beforeUserAuthLogin($api, &$data)
	{
		$roles = AclHelper::getUserRoles($data->id);
		$data->roles = $roles;
	}
}
```

Что бы обработчик сработал вам нужно сздать в классе метод, который бедет соответствовать имени событиия но переведенный в _Cammel Case_. То есть `before_user_auth_logout` превращатеся в `beforeUserAuthLogin`.

Каждое событе имет свои параметры котрые оно принимает. Смотрите документацию по событиям что бы занть какие события вы можете использовать.

### Как создать событие

Что бы создать свое событие, вам так же сначало нужно объявить его в файле `meta.json`. Вот пример:

```json
{
	"title": "My Module",
	"events": {
		"trigger": [
			{
				"name":"module_event_name",
				"description": "Описание события, где оно запускатся и т.д.",
				"params": [
					{
						"name":"user",
						"description": "Объект текущего пользователя"
					}
				]
			}
		]
	}
}
```

Ну это в кратце. Обхект параметров имеет больше JSON ключей, вы можете это видеть в выпадающей подсказке но вот это как бы основа. 

В ключе `trigger` у нас массив, список событий кторые есть в нашем модуле. 

От сюда и берется документация где вы можете просмотреть список все возможных событий в сиистеме. Так что заполняя этот раздел  `meta.json` не скупитесь на описания, что бы другие пользователи могли качественно утилизировать ваш труд. Тут же будет и список опускаемых в метод параметров.

Но это использвется не только для документации, это нужно и для запуска самих событий.

Теперь в коде где угодно 

```php
\App\Lib\Events::trigger('module_event_name', [$user]);
```

Первый параметер это имя события, а вотрой это массив параметров.
 

### Глобальные события

В улакос есть 2 основных глобальных события. Одно срабатывает до запуска любого метода API а друге после. Имя события составлется из `prefix_[module]_[api_group]_[api_name]` где `prefix_` может быть `before_` или `after_`. Например:

- `after_users_profile_login` - событие после того как пользователь был авторизован
- `before_acl_role_setuser` - Преджде чем новая роль назначена пользователю.


#### Заключение 

Представляете все возможности которые открывают для нас система плагинов? Она действительно огромна. По большей части вам не нужно будет создававть ни каких событий и в 90% случаев, 2х глобальных точек событий будет достаточнок что бы повлиять на что угодно.