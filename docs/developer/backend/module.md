# Что такое модуль

Модуль это одна папка логически объединяющая в себе несколько точек доступа. Это сделано для удобной организации точек доступа и связанных с ними логических операций по категориям и группам. Вся бизнес логика, содержится только в модулях. Все что за модулями, это просто структура самого приложения АПИ.

### Почему модуль?

Это сложилось исторически. Изначально данный бэкэнд разрабатывался для приложения для которого сторонние разработчики должны были писать расширения. По идеи модуль это папка подобного расширения, добавляющая функционал в приложение. Именно по этому модуль это отдельная папка, и для коммуникации модулей друг с другом есть система событий.

Используя эту наработку для ICOD мы разбили точки доступа на логические группы и категории. Например точки доступа модуля Users это логин, логаут, регистрация, восстановление пароля и т.д.

## Модуль API

### Структура модуля

Рассмотрим типичную структуру модуля. Это будет полезно что бы быстро найти нужный участок года который нужно поправить, а так же для создания нового модуля. Все модули находятся в папке проекта `./modules`.

```text
modules
`-- Users
    |-- Api
    |-- Doc
    |  `-- readme.md
    |-- Lib
    |  `-- Helper.php
    |-- Models
    |  `-- Example.php
    |-- i18n
    |  `-- en-GB.guestbook.json
    |-- acl.json
    `-- meta.json
```

- `Api` - Содержит методы JSON API. О них немного позже.

- `Doc` - Одной из целей ICOD, это создания хорошо задокументированой платформы. Папка `Doc` содержит markdown файлы с описаниями. Как привило на них указывается в JSON файлах, в поле `description` если короткий текст нельзя использовать. Об этом подробнее чуть позже.

- `Lib` - Папка где вы можете создавать свою библиотеку, классы помощники, для использования в методах АПИ или в других модулях. В этой папке, по умолчанию, как пример будет создан файл `Helper.php`.

- `i18n` - Содержит языковые переводы вашего модуля. Но не беспокойтесь, это совсем не обязательно. Вы можете создавать свой модуль не используя стратегию для многоязычности. Это ваш выбор. А если вы будете использовать, то большая часть этого процесса автоматизирована.

- `Models` - ICOD утилизирует великолепную ORM от Larave по имени Eloquent. Это удобно, потому что она элегантна, и документация достаточно полная. В этой папке хранятся модели Eloquent. Одна модель, одна таблица базы данных. Одна модель как пример будет создана.

- `acl.json` - В этом файле вы объявляете правила ACL. [Подробнее...](acl.md)

- `meta.json` - Этот файл содержит общие сведения о вашем модуле.

### Создание модуля

Для создания нового модуля можно воспользоваться командой в терминале.

```text
icod module modulename
```

Следующим шагом будет редактирования некоторых файлов. На данный момент нам нужно только отредактировать файл `meta.json`. Для общего понимания значения и работы файлов JSON [читайте тут](json.md).

```json
{
    "title": "",
    "description": "readme.md",
    "events": {
        "register": {
            "after_users_profile_login": "\\Users\\Lib\\Helper"
        },
        "trigger": []
    },
    "extend": [
        "User\\Llib\Filters"
    ]
}
```

Модуль будут работать и без заполнения всех полей. Данные этих полей носят информационный характер, и служат для автоматической генерации документации по АПИ.

- `title` - Короткое название модуля
- `description` - Описание.
- `events` - Данные по обработке или запуска событий. Подробно о событиях [подробнее тут...](events.md)
  - `register` - В этом блоке, вы регистрируете на какие события ваш модуль должен срабатывать и какой класс содержит обработчик. В фале `Lib/Helper.php` вы можете посмотреть как это событие обработано.
  - `trigger` - В этом блоке, список событий которые ваш модуль запускает. Это нужно как для документации, что бы другие пользователи знали что у вас есть, так и для автоматической проверки вводных данных что бы вам не писать лишний код валидации.
- `extend` - список классе чтобы автоматически расширить ваш класс метода АПИ. Например вы хотите использовать какието фильтры другого модуля вызывая их через `$this->`.
